# Deva Admin UI 使用指南

## 目录

- [快速开始](#快速开始)
- [界面概览](#界面概览)
- [导航菜单](#导航菜单)
- [功能模块使用](#功能模块使用)
- [快捷键](#快捷键)
- [常见问题](#常见问题)

---

## 快速开始

### 1. 启动 Admin UI

```python
from deva import admin

# 启动管理界面
admin.main()
```

访问 `http://localhost:8080/` 即可打开 Admin UI。

### 2. 首次使用

首次访问时会引导创建管理员账号：

1. 输入管理员用户名
2. 设置密码（至少 6 位）
3. 确认密码
4. 点击"创建管理员账户"

创建完成后使用账号登录。

---

## 界面概览

### 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  ⚡ Deva    [导航菜单]                     [汉堡菜单]    │
├─────────────┬───────────────────────────────────────────┤
│             │                                           │
│             │  📋 定时任务                              │
│             │  [任务列表]                               │
│             │                                           │
│   主内容区   │  ─────────────────────────────────────    │
│             │                                           │
│             │  📋 系统日志                              │
│             │  [实时日志框]                             │
│             │                                           │
│             │  ─────────────────────────────────────    │
│             │                                           │
│             │  📱 Dtalk 消息存档                        │
│             │  [消息列表]                               │
│             │                                           │
├─────────────┴───────────────────────────────────────────┤
│  [访问日志]  ← 右侧边栏（可折叠）                         │
└─────────────────────────────────────────────────────────┘
```

### 界面元素

| 区域 | 说明 |
|------|------|
| **顶部导航栏** | 显示 Logo 和主导航菜单，响应式设计 |
| **主内容区** | 显示当前页面的主要内容 |
| **右侧边栏** | 显示访问日志，可折叠/展开 |
| **底部** | ICP 备案号等信息 |

---

## 导航菜单

### 菜单项列表

| 图标 | 名称 | 路径 | 说明 |
|------|------|------|------|
| 🏠 | 首页 | `/` | 系统概览和快捷操作 |
| ⭐ | 关注 | `/followadmin` | 关注的人和话题管理 |
| 🌐 | 浏览器 | `/browseradmin` | 浏览器标签页和书签管理 |
| 💾 | 数据库 | `/dbadmin` | SQLite 数据库管理 |
| 🚌 | Bus | `/busadmin` | 进程间消息总线管理 |
| 📊 | 命名流 | `/streamadmin` | 数据流监控和管理 |
| 📡 | 数据源 | `/datasourceadmin` | 数据源配置和管理 |
| 📈 | 策略 | `/strategyadmin` | 量化策略管理 |
| 👁 | 监控 | `/monitor` | 系统监控面板 |
| ⏰ | 任务 | `/taskadmin` | 定时任务管理 |
| ⚙️ | 配置 | `/configadmin` | 系统配置管理 |
| 📄 | 文档 | `/document` | API 文档查看 |
| 🤖 | AI | `/aicenter` | AI 功能中心 |

### 导航栏功能

- **响应式设计**：移动端自动切换为汉堡菜单
- **当前页面高亮**：当前访问的菜单项高亮显示
- **点击跳转**：点击菜单项跳转到对应页面
- **SSE 连接管理**：页面跳转时自动管理 SSE 连接

---

## 功能模块使用

### 1. 首页 (`/`)

**功能**：系统概览和快捷操作

**主要卡片**：

#### ⏰ 定时任务
- 显示所有定时任务列表
- 点击任务名称查看详情
- 快速操作：启动/停止/删除任务

```
┌─────────────────────────────────────┐
│  ⏰ 定时任务                         │
│  [📋 task1] [📋 task2] [📋 task3]   │
│                                     │
│  任务详情：                          │
│  函数名：my_task                    │
│  间隔：60 秒                         │
│  状态：运行中                        │
└─────────────────────────────────────┘
```

#### 📋 系统日志
- 实时显示系统日志
- 支持日志滚动和搜索
- 手动写入日志功能

```
┌─────────────────────────────────────┐
│  📋 系统日志                         │
│  ┌─────────────────────────────────┐│
│  │ 10:30:15 - 任务启动              ││
│  │ 10:30:16 - 数据加载完成          ││
│  │ 10:30:17 - 处理完成              ││
│  └─────────────────────────────────┘│
│  [🔧 调试工具 ▼]                    │
└─────────────────────────────────────┘
```

#### 🔧 调试工具
- 手动写入日志内容
- 测试系统功能

```
┌─────────────────────────────────────┐
│  🔧 调试工具                         │
│  [输入框：手动写入日志内容...] [📤 发送]│
└─────────────────────────────────────┘
```

#### 📱 Dtalk 消息存档
- 查看历史消息
- 消息详情查看
- 删除消息

### 2. 任务管理 (`/taskadmin`)

**功能**：定时任务的创建、管理和监控

**主要功能**：

#### 创建定时任务

点击"创建定时任务"按钮，填写表单：

```
┌─────────────────────────────────────┐
│  创建定时任务                        │
│  ─────────────────────────────────  │
│  任务名称：[________________]       │
│  任务类型：[定时任务 ▼]             │
│  执行间隔：[60] 秒                   │
│  任务代码：                          │
│  ┌─────────────────────────────────┐│
│  │ def my_task():                  ││
│  │     print("Hello")              ││
│  │     return True                 ││
│  └─────────────────────────────────┘│
│  [创建] [取消]                      │
└─────────────────────────────────────┘
```

#### 任务类型

| 类型 | 说明 | 配置项 |
|------|------|--------|
| **定时任务** | 按固定间隔执行 | 间隔秒数 |
| **周期任务** | 按 Cron 表达式执行 | Cron 表达式 |
| **一次性任务** | 只执行一次 | 执行时间 |

#### 任务管理操作

| 操作 | 说明 |
|------|------|
| ▶️ 启动 | 启动已停止的任务 |
| ⏸️ 停止 | 暂停运行中的任务 |
| 🗑️ 删除 | 删除任务（可恢复） |
| ♻️ 恢复 | 恢复已删除的任务 |
| 🔃 永久删除 | 彻底删除任务 |

### 3. 数据源管理 (`/datasourceadmin`)

**功能**：数据源的创建、配置和监控

**数据源类型**：

| 类型 | 说明 | 适用场景 |
|------|------|---------|
| **定时器** | 定时获取数据 | 股票行情、新闻采集 |
| **流** | 实时数据流 | WebSocket、消息队列 |
| **回放** | 历史数据回放 | 策略回测、数据重放 |

**操作流程**：

1. 点击"创建数据源"
2. 选择数据源类型
3. 填写配置信息
4. 测试连接
5. 启动数据源

### 4. 策略管理 (`/strategyadmin`)

**功能**：量化策略的创建、回测和执行

**主要功能**：

#### 策略创建

```
┌─────────────────────────────────────┐
│  创建策略                            │
│  ─────────────────────────────────  │
│  策略名称：[________________]       │
│  策略类型：[股票策略 ▼]             │
│  数据源：[stock_data ▼]             │
│  策略代码：                          │
│  ┌─────────────────────────────────┐│
│  │ # 双均线策略                    ││
│  │ def on_bar(data):               ││
│  │     ma5 = data.close.rolling(5) ││
│  │     ma20 = data.close.rolling(20)││
│  │     if cross_over(ma5, ma20):   ││
│  │         buy()                   ││
│  └─────────────────────────────────┘│
│  [AI 生成代码] [手动输入]            │
│  [创建] [取消]                      │
└─────────────────────────────────────┘
```

#### AI 代码生成

点击"AI 生成代码"，输入策略要求：

```
策略要求：
生成一个双均线策略，使用 5 日和 20 日均线，
金叉时买入，死叉时卖出，包含止损逻辑。

[生成代码]
```

AI 会自动生成策略代码并提供审核和编辑功能。

#### 策略回测

1. 选择策略
2. 设置回测时间段
3. 设置初始资金
4. 点击"开始回测"
5. 查看回测报告

### 5. AI 功能中心 (`/aicenter`)

**功能**：AI 辅助的代码生成、数据分析等功能

**主要功能模块**：

#### AI 聊天

```
┌─────────────────────────────────────┐
│  🤖 AI 助手                          │
│  ─────────────────────────────────  │
│  ┌─────────────────────────────────┐│
│  │ 用户：生成一个数据采集脚本      ││
│  │                                 ││
│  │ AI: 好的，这是一个数据采集脚本： ││
│  │ ```python                       ││
│  │ import requests                 ││
│  │ ...                             ││
│  │ ```                             ││
│  └─────────────────────────────────┘│
│  [输入消息...] [发送]               │
└─────────────────────────────────────┘
```

#### 代码生成器

| 类型 | 说明 |
|------|------|
| **Python 代码生成** | 根据需求生成 Python 代码 |
| **Deva 策略生成** | 生成量化策略代码 |
| **Deva 数据源生成** | 生成数据源配置代码 |
| **Deva 任务生成** | 生成定时任务代码 |

#### 文本处理

| 功能 | 说明 |
|------|------|
| **文本摘要** | 自动生成文章摘要 |
| **翻译** | 多语言翻译 |
| **文本润色** | 改进文本表达 |
| **文本分析** | 情感分析、关键词提取 |

### 6. 数据库管理 (`/dbadmin`)

**功能**：SQLite 数据库的 CRUD 操作

**主要功能**：

- 查看所有数据表
- 表数据浏览和编辑
- 新增/删除键值对
- 数据导入导出

### 7. 命名流管理 (`/streamadmin`)

**功能**：数据流的监控和管理

**主要功能**：

- 查看所有命名流
- 流状态监控
- 流数据查看
- 流的启动/停止

### 8. 监控面板 (`/monitor`)

**功能**：系统运行状态监控

**监控内容**：

- CPU 和内存使用率
- 数据流状态
- 任务执行情况
- 错误日志统计

### 9. 配置管理 (`/configadmin`)

**功能**：系统配置管理

**配置项**：

- LLM 服务配置
- 认证配置
- 系统参数配置

### 10. 文档查看 (`/document`)

**功能**：API 文档查看

**文档内容**：

- 模块文档
- 类和方法文档
- 使用示例

### 11. 浏览器管理 (`/browseradmin`)

**功能**：浏览器标签页和书签管理

**主要功能**：

- 打开新标签页
- 查看标签页列表
- 书签管理
- 标签页摘要生成

### 12. 关注管理 (`/followadmin`)

**功能**：关注的人和话题管理

**主要功能**：

- 添加关注话题
- 添加关注人
- 查看关注动态

---

## 右侧边栏

### 访问日志

**位置**：页面右侧，可折叠

**功能**：
- 实时显示系统访问日志
- 自动滚动到最新日志
- 支持日志筛选

**操作**：
- 点击右侧按钮展开/折叠
- 状态会自动保存

---

## 快捷键

| 快捷键 | 功能 | 适用页面 |
|--------|------|---------|
| `Ctrl + K` | 快速搜索 | 全局 |
| `Ctrl + Enter` | 提交表单 | 所有表单页面 |
| `Esc` | 关闭弹窗 | 所有弹窗 |
| `F5` | 刷新页面 | 全局 |
| `Ctrl + S` | 保存配置 | 配置页面 |

---

## 常见问题

### Q1: 无法登录怎么办？

**A**: 检查用户名和密码是否正确。如果忘记密码，可以删除配置文件重置：

```bash
# 删除配置（会重置所有配置）
rm ~/.deva/config.json
```

### Q2: 日志不显示怎么办？

**A**: 检查 SSE 连接是否正常：
1. 打开浏览器开发者工具
2. 查看 Console 是否有 SSE 连接错误
3. 刷新页面重新建立连接

### Q3: 任务无法启动怎么办？

**A**: 检查任务代码是否正确：
1. 查看任务代码是否有语法错误
2. 查看系统日志中的错误信息
3. 确保任务依赖已安装

### Q4: AI 功能无法使用怎么办？

**A**: 检查 LLM 配置：
1. 前往配置页面检查 LLM 配置
2. 确保 API Key 正确
3. 检查网络连接

### Q5: 页面加载缓慢怎么办？

**A**: 尝试以下操作：
1. 清理浏览器缓存
2. 减少同时显示的数据量
3. 检查服务器资源使用情况

### Q6: 如何备份配置？

**A**: 备份 `~/.deva/` 目录：

```bash
# 备份
cp -r ~/.deva ~/.deva.backup

# 恢复
cp -r ~/.deva.backup ~/.deva
```

### Q7: 如何导出任务列表？

**A**: 在任务管理页面：
1. 点击"导出任务"按钮
2. 选择导出格式（JSON/YAML）
3. 保存导出文件

### Q8: 如何批量操作任务？

**A**: 目前支持单个操作，批量操作功能开发中。临时方案：
1. 导出任务配置
2. 批量修改配置文件
3. 导入修改后的配置

---

## 最佳实践

### 1. 任务命名规范

```python
# ✅ 推荐
daily_report      # 日报表
hourly_backup     # 每小时备份
realtime_monitor  # 实时监控

# ❌ 不推荐
task1
test
abc
```

### 2. 日志使用

```python
# ✅ 推荐：使用日志上下文
from deva.admin_ui.strategy.logging_context import task_log

task_log.info('任务启动', extra={'task_id': 'my_task'})
task_log.error('任务失败', exc_info=True)

# ❌ 不推荐：直接 print
print('任务启动')
```

### 3. 错误处理

```python
# ✅ 推荐：完整的错误处理
try:
    result = risky_operation()
except Exception as e:
    task_log.error(f'操作失败：{e}', exc_info=True)
    raise

# ❌ 不推荐：忽略错误
try:
    result = risky_operation()
except:
    pass
```

### 4. 资源配置

```python
# ✅ 推荐：合理的资源限制
create_task(
    name='my_task',
    max_retries=3,        # 最大重试次数
    timeout=300,          # 超时时间（秒）
    memory_limit='512MB'  # 内存限制
)

# ❌ 不推荐：无限制
create_task(
    name='my_task'
    # 无任何限制
)
```

---

## 技术支持

- **文档**：`deva/admin_ui/README.md`
- **问题反馈**：GitHub Issues
- **讨论交流**：GitHub Discussions

---

**文档版本**: 1.0.0  
**最后更新**: 2026-02-27
