<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

.markdown-body diagram-div, .markdown-body div.uml-sequence-diagram, .markdown-body, div.uml-flowchart {
  overflow: auto;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>core</title></head><body><article class="markdown-body"><p>from <strong>future</strong> import absolute_import, division, print_function
import os</p>
<p>import collections
from datetime import datetime, timedelta
import functools
import logging
import six
import sys
import threading
import weakref
import inspect</p>
<p>import toolz
from tornado import gen
from tornado.ioloop import IOLoop
try:
    from tornado.ioloop import PollIOLoop
except ImportError:
    PollIOLoop = None  # dropped in tornado 6.0</p>
<p>from expiringdict import ExpiringDict
from pampy import match, ANY
import io
from .pipe import P, print
from threading import get_ident as get_thread_identity
from requests_html import AsyncHTMLSession</p>
<p>no_default = &lsquo;&ndash;no-default&ndash;&lsquo;</p>
<h1 id="sinks-add-themselves-here-to-avoid-being-garbage-collected">sinks add themselves here to avoid being garbage-collected<a class="headerlink" href="#sinks-add-themselves-here-to-avoid-being-garbage-collected" title="Permanent link"></a></h1>
<p>_global_sinks = set()</p>
<p>_html_update_streams = set()</p>
<p>thread_state = threading.local()</p>
<p>logger = logging.getLogger(<strong>name</strong>)</p>
<p>_io_loops = []</p>
<p>class OrderedSet(collections.abc.MutableSet):
    def <strong>init</strong>(self, values=()):
        self._od = collections.OrderedDict().fromkeys(values)</p>
<pre><code>def __len__(self):
    return len(self._od)

def __iter__(self):
    return iter(self._od)

def __contains__(self, value):
    return value in self._od

def add(self, value):
    self._od[value] = None

def discard(self, value):
    self._od.pop(value, None)
</code></pre>
<p>class OrderedWeakrefSet(weakref.WeakSet):
    def <strong>init</strong>(self, values=()):
        super(OrderedWeakrefSet, self).<strong>init</strong>()
        self.data = OrderedSet()
        for elem in values:
            self.add(elem)</p>
<p>def get_io_loop(asynchronous=None):
    if asynchronous:
        return IOLoop.current()</p>
<pre><code>if not _io_loops:
    loop = IOLoop()
    thread = threading.Thread(target=loop.start)
    thread.daemon = True
    thread.start()
    _io_loops.append(loop)

return _io_loops[-1]
</code></pre>
<p>def identity(x):
    return x</p>
<p>class Stream(object):
    &ldquo;&rdquo;&rdquo; A Stream is an infinite sequence of data</p>
<pre><code>Streams subscribe to each other passing and transforming data between them.
A Stream object listens for updates from upstream, reacts to these updates,
and then emits more data to flow downstream to all Stream objects that
subscribe to it.  Downstream Stream objects may connect at any point of a
Stream graph to get a full view of the data coming off of that point to do
with as they will.

Parameters
----------
asynchronous: boolean or None
    Whether or not this stream will be used in asynchronous functions or
    normal Python functions.  Leave as None if you don't know.
    True will cause operations like emit to return awaitable Futures
    False will use an Event loop in another thread (starts it if necessary)
ensure_io_loop: boolean
    Ensure that some IOLoop will be created.  If asynchronous is None or
    False then this will be in a separate thread, otherwise it will be
    IOLoop.current

Examples
--------
&gt;&gt;&gt; def inc(x):
...     return x + 1

&gt;&gt;&gt; source = Stream()  # Create a stream object
&gt;&gt;&gt; s = source.map(inc).map(str)  # Subscribe to make new streams
&gt;&gt;&gt; s.sink(print)  # take an action whenever an element reaches the end

&gt;&gt;&gt; L = list()
&gt;&gt;&gt; s.sink(L.append)  # or take multiple actions (streams can branch)

&gt;&gt;&gt; for i in range(5):
...     source.emit(i)  # push data in at the source
'1'
'2'
'3'
'4'
'5'
&gt;&gt;&gt; L  # and the actions happen at the sinks
['1', '2', '3', '4', '5']
"""
_graphviz_shape = 'ellipse'
_graphviz_style = 'rounded,filled'
_graphviz_fillcolor = 'white'
_graphviz_orientation = 0

_instances = set()

str_list = ['func', 'predicate', 'n', 'interval', 'port', 'host',
            'ttl', 'cache_max_len', '_scheduler', 'filename', 'path']

def __init__(self, upstream=None, upstreams=None, name=None,
             cache_max_len=None, cache_max_age_seconds=None,  # 缓存长度和事件长度
             loop=None, asynchronous=None, ensure_io_loop=False,
             refuse_none=True):  # 禁止传递None到下游
    self.downstreams = OrderedWeakrefSet()
    if upstreams is not None:
        self.upstreams = list(upstreams)
    else:
        self.upstreams = [upstream]

    self._set_asynchronous(asynchronous)
    self._set_loop(loop)
    if ensure_io_loop and not self.loop:
        self._set_asynchronous(False)
    if self.loop is None and self.asynchronous is not None:
        self._set_loop(get_io_loop(self.asynchronous))

    for upstream in self.upstreams:
        if upstream:
            upstream.downstreams.add(self)

    self.name = name

    self.cache = {}
    self.is_cache = False
    if cache_max_len or cache_max_age_seconds:
        self.start_cache(cache_max_len, cache_max_age_seconds)

    self.refuse_none = refuse_none

    self.handlers = []

    self.__class__._instances.add(weakref.ref(self))

def start_cache(self, cache_max_len=None, cache_max_age_seconds=None):
    """
        缓冲开启
        cache_max_len 缓存长度
        cache_max_age_seconds 缓存时间
    """
    self.is_cache = True
    self.cache_max_len = cache_max_len or 1
    self.cache_max_age_seconds = cache_max_age_seconds or 60 * 5
    self.cache = ExpiringDict(
        max_len=self.cache_max_len,
        max_age_seconds=self.cache_max_age_seconds
    )

def stop_cache(self,):
    self.is_cache = False

def clear_cache(self,):
    self.cache.clear()

def _set_loop(self, loop):
    self.loop = None
    if loop is not None:
        self._inform_loop(loop)
    else:
        for upstream in self.upstreams:
            if upstream and upstream.loop:
                self.loop = upstream.loop
                break

def _inform_loop(self, loop):
    """
    Percolate information about an event loop to the rest of the stream
    """
    if self.loop is not None:
        if self.loop is not loop:
            raise ValueError("Two different event loops active")
    else:
        self.loop = loop
        for upstream in self.upstreams:
            if upstream:
                upstream._inform_loop(loop)
        for downstream in self.downstreams:
            if downstream:
                downstream._inform_loop(loop)

def _set_asynchronous(self, asynchronous):
    self.asynchronous = None
    if asynchronous is not None:
        self._inform_asynchronous(asynchronous)
    else:
        for upstream in self.upstreams:
            if upstream and upstream.asynchronous:
                self.asynchronous = upstream.asynchronous
                break

def _inform_asynchronous(self, asynchronous):
    """
    Percolate information about an event loop to the rest of the stream
    """
    if self.asynchronous is not None:
        if self.asynchronous is not asynchronous:
            raise ValueError(
                "Stream has both asynchronous and synchronous elements")
    else:
        self.asynchronous = asynchronous
        for upstream in self.upstreams:
            if upstream:
                upstream._inform_asynchronous(asynchronous)
        for downstream in self.downstreams:
            if downstream:
                downstream._inform_asynchronous(asynchronous)

@classmethod
def instances(cls):
    dead = set()
    for ref in cls._instances:
        obj = ref()
        if obj is not None:
            yield obj
        else:
            dead.add(ref)
    cls._instances -= dead

streams = instances

@classmethod
def register_api(cls, modifier=identity):
    """ Add callable to Stream API

    This allows you to register a new method onto this class.  You can use
    it as a decorator.::

        &gt;&gt;&gt; @Stream.register_api()
        ... class foo(Stream):
        ...     ...

        &gt;&gt;&gt; Stream().foo(...)  # this works now

    It attaches the callable as a normal attribute to the class object.  In
    doing so it respsects inheritance (all subclasses of Stream will also
    get the foo attribute).

    By default callables are assumed to be instance methods.  If you like
    you can include modifiers to apply before attaching to the class as in
    the following case where we construct a ``staticmethod``.

        &gt;&gt;&gt; @Stream.register_api(staticmethod)
        ... class foo(Stream):
        ...     ...

        &gt;&gt;&gt; Stream.foo(...)  # Foo operates as a static method
    """
    def _(func):
        @functools.wraps(func)
        def wrapped(*args, **kwargs):
            return func(*args, **kwargs)
        setattr(cls, func.__name__, modifier(wrapped))
        return func
    return _

def start(self):
    """ Start any upstream sources """
    for upstream in self.upstreams:
        upstream.start()

def __str__(self):
    s_list = []
    if self.name:
        s_list.append('{}; {}'.format(
            self.name, self.__class__.__name__))
    else:
        s_list.append(self.__class__.__name__)

    for m in self.str_list:
        s = ''
        at = getattr(self, m, None)
        if at:
            if not callable(at):
                s = str(at)
            elif hasattr(at, '__name__'):
                s = getattr(self, m).__name__
            elif hasattr(at.__class__, '__name__'):
                s = getattr(self, m).__class__.__name__
            else:
                s = None
        if s:
            s_list.append('{}={}'.format(m, s))
    if len(s_list) &lt;= 2:
        s_list = [term.split('=')[-1] for term in s_list]

    text = "&lt;"
    text += s_list[0]
    if len(s_list) &gt; 1:
        text += ': '
        text += ', '.join(s_list[1:])
    text += '&gt;'
    return text

__repr__ = __str__

def _ipython_display_(self, **kwargs):
    try:
        from ipywidgets import Output
        import IPython
    except ImportError:
        if hasattr(self, '_repr_html_'):
            return self._repr_html_()
        else:
            return self.__repr__()
    output = Output(_view_count=0)
    output_ref = weakref.ref(output)

    def update_cell(val):
        output = output_ref()
        if output is None:
            return
        with output:
            IPython.display.clear_output(wait=True)
            IPython.display.display(val)

    s = self.map(update_cell)
    _html_update_streams.add(s)

    self.output_ref = output_ref
    s_ref = weakref.ref(s)

    def remove_stream(change):
        output = output_ref()
        if output is None:
            return

        if output._view_count == 0:
            ss = s_ref()
            ss.destroy()
            _html_update_streams.remove(ss)  # trigger gc

    output.observe(remove_stream, '_view_count')

    return output._ipython_display_(**kwargs)

def _emit(self, x):
    if self.is_cache:
        self.cache[datetime.now()] = x

    if self.refuse_none and x is None:
        return

    result = []
    for downstream in list(self.downstreams):
        r = downstream.update(x, who=self)
        if type(r) is list:
            result.extend(r)
        else:
            result.append(r)

    return [element for element in result if element is not None]

def emit(self, x, asynchronous=False):
    """ Push data into the stream at this point

    This is typically done only at source Streams but can theortically be
    done at any point
    """
    ts_async = getattr(thread_state, 'asynchronous', False)
    if self.loop is None or asynchronous or self.asynchronous or ts_async:
        if not ts_async:
            thread_state.asynchronous = True
        try:
            result = self._emit(x)
            if self.loop:
                return gen.convert_yielded(result)
        finally:
            thread_state.asynchronous = ts_async
    else:
        @gen.coroutine
        def _():
            thread_state.asynchronous = True
            try:
                result = yield self._emit(x)
            finally:
                del thread_state.asynchronous

            raise gen.Return(result)
        sync(self.loop, _)

def update(self, x, who=None):
    self._emit(x)

def gather(self):
    """ This is a no-op for core streamz

    This allows gather to be used in both dask and core streams
    """
    return self

def connect(self, downstream):
    ''' Connect this stream to a downstream element.

    Parameters
    ----------
    downstream: Stream
        The downstream stream to connect to
    '''
    self.downstreams.add(downstream)

    if downstream.upstreams == [None]:
        downstream.upstreams = [self]
    else:
        downstream.upstreams.append(self)

def disconnect(self, downstream):
    ''' Disconnect this stream to a downstream element.

    Parameters
    ----------
    downstream: Stream
        The downstream stream to disconnect from
    '''
    self.downstreams.remove(downstream)

    downstream.upstreams.remove(self)

@property
def upstream(self):
    if len(self.upstreams) != 1:
        raise ValueError("Stream has multiple upstreams")
    else:
        return self.upstreams[0]

def destroy(self, streams=None):
    """
    Disconnect this stream from any upstream sources
    """
    if streams is None:
        streams = self.upstreams
    for upstream in list(streams):
        upstream.downstreams.remove(self)
        self.upstreams.remove(upstream)

def scatter(self, **kwargs):
    from .dask import scatter
    return scatter(self, **kwargs)

def remove(self, predicate):
    """Only pass through elements for which the predicate returns False """
    return self.filter(lambda x: not predicate(x))

@property
def scan(self):
    return self.accumulate

@property
def concat(self):
    return self.flatten

def to_list(self):
    """ Append all elements of a stream to a list as they come in

    Examples
    --------
    &gt;&gt;&gt; source = Stream()
    &gt;&gt;&gt; L = source.map(lambda x: 10 * x).to_list()
    &gt;&gt;&gt; for i in range(5):
    ...     source.emit(i)
    &gt;&gt;&gt; L
    [0, 10, 20, 30, 40]
    """
    L = []
    self.sink(L.append)
    return L

def frequencies(self, **kwargs):
    """ Count occurrences of elements """
    def update_frequencies(last, x):
        return toolz.assoc(last, x, last.get(x, 0) + 1)

    return self.scan(update_frequencies, start={}, **kwargs)

def visualize(self, filename='mystream.png', source_node=False, **kwargs):
    """Render the computation of this object's task graph using graphviz.

    Requires ``graphviz`` to be installed.

    Parameters
    ----------
    filename : str, optional
        The name of the file to write to disk.
    source_node: bool, optional
        If True then the node is the source node and we can label the
        edges in their execution order. Defaults to False
    kwargs:
        Graph attributes to pass to graphviz like ``rankdir="LR"``
    """
    from .graph import visualize
    return visualize(self, filename, source_node=source_node, **kwargs)

def attend(self, x):
    """#async等将执行结果入流"""
    assert isinstance(x, gen.Awaitable)
    futs = gen.convert_yielded(x)
    self.loop = self.loop or get_io_loop()
    self.loop.add_future(futs, lambda x: self._emit(x.result()))

def __ror__(self, x):  # |
    """emit value to stream ,end,return emit result"""
    if isinstance(x, gen.Awaitable):
        self.attend(x)
    else:
        self.emit(x, asynchronous=False)
    return x

def __rrshift__(self, x):  # stream左边的&gt;&gt;
    """emit value to stream ,end,return emit result"""
    # self.emit(value, asynchronous=True)
    return self.__ror__(x)

def __lshift__(self, x):  # stream右边的&lt;&lt;
    """emit value to stream ,end,return emit result"""
    return self.__ror__(x)

def catch(self, func):
    """捕获函数执行结果到流内.

    examples::

        @log.catch
        @warn.catch_except
        def f1(*args,**kwargs):
            return sum(*args,**kwargs)


        @log.catch
        @gen.coroutine
        def a_foo(n):
            yield gen.sleep(n)
            print(1)
            return 123

        @log.catch
        async def a_foo(n):
            import asyncio
            await asyncio.sleep(n)
            print(1)
            return 123

    """

    # @Pipe
    @functools.wraps(func)
    def wraper(*args, **kwargs):
        result = func(*args, **kwargs)
        # 异步函数
        if isinstance(result, gen.Awaitable):
            futs = gen.convert_yielded(result)
            if not self.loop:
                self._set_asynchronous(False)
            if self.loop is None and self.asynchronous is not None:
                self._set_loop(get_io_loop(self.asynchronous))
            self.loop.add_future(futs, lambda x: self._emit(x.result()))

        # 同步函数
        else:
            self._emit(result)

        return result

    return wraper.__call__ @ P

def catch_except(self, func):
    """捕获函数执行异常到流内.

    examples::

        @log.catch
        @warn.catch_except
        def f1(*args,**kwargs):
            return sum(*args,**kwargs)

    """
    @functools.wraps(func)
    def wraper(*args, **kwargs):
        # some action before
        try:
            return func(*args, **kwargs)  # 需要这里显式调用用户函数
        except Exception as e:
            {
                'function': func.__name__,
                'param': (args, kwargs),
                'except': e,
            } &gt;&gt; self

    return wraper.__call__ @ P

def __rmatmul__(self, func):
    """左边的 @.，函数结果进入流内."""
    return self.catch(func).__call__ @ P

def __rxor__(self, func):
    """左边的 ^.，函数异常入流.优先级不高"""
    return self.catch_except(func).__call__ @ P

def __rshift__(self, ref):  # stream右边的
    """Stream右边&gt;&gt;,sink到右边的对象.

    支持5种类型:list| text file| str | stream | callable
    """
    return match(ref,
                 list, lambda ref: self.sink(ref.append),
                 io.TextIOWrapper, lambda ref: self.to_textfile(ref),
                 str, lambda ref: self.map(str).to_textfile(ref),
                 Stream, lambda ref: self.sink(ref.emit),
                 # 内置函数被转换成pipe，不能pipe优先，需要stream的sink优先
                 # Pipe, lambda ref: ref(self),
                 callable, lambda ref: self.sink(ref),
                 ANY, lambda ref: TypeError(
                     f'{ref}:{type(ref)} is'
                     'Unsupported type, must be '
                     'list| str | text file| stream | callable')
                 )

def __getitem__(self, *args):
    return self.cache.values().__getitem__(*args)

def route(self, occasion):
    """路由函数.

    :param occasion: 路由函数表达式,
    比如 lambda x:x.startswith('foo')
    或者 lambda x:type(x)==str

    examples::
        e = Stream.engine()
        e.start()

        @e.route(lambda x:type(x)==int)
        def goo(x):
            x*2&gt;&gt;log

        @bus.route('world')
        def goo(x):
            print('hello',x)

    """
    def param_wraper(func):
        """ 预处理函数，定义包装函数wraper取代老函数.
        定义完成后将目标函数增加到handlers中
        """
        @functools.wraps(func)
        def wraper(*args, **kwargs):
            """包装函数，这个函数是处理用户函数的，在用户函数执行前和执行后分别执行任务，甚至可以处理函数的参数"""
            func(*args, **kwargs)  # 需要这里显式调用用户函数

        if callable(occasion):
            self.filter(occasion).sink(wraper)
        else:
            self.filter(lambda x: x == occasion).sink(wraper)

        # self.filter(occasion).sink(wraper)
        self.handlers.append((occasion, func))
        # 包装定义阶段执行，包装后函数是个新函数了，
        # 老函数已经匿名，需要新函数加入handlers列表,这样才可以执行前后发消息
        return wraper
        # 返回的这个函数实际上取代了老函数。
        # 为了将老函数的函数名和docstring继承，需要用functools的wraps将其包装

    return param_wraper

# @property
def recent(self, n=5, seconds=None):
    if self.is_cache:
        if not seconds:
            return self.cache.values()[-n:]
        else:
            begin = datetime.now() - timedelta(seconds=seconds)
            return [i[1] for i in self.cache.items() if begin &lt; i[0]]
    else:
        return {}

def __iter__(self,):
    return self.cache.values().__iter__()
</code></pre>
<p>class Sink(Stream):</p>
<pre><code>_graphviz_shape = 'trapezium'

def __init__(self, upstream, **kwargs):
    super().__init__(upstream, **kwargs)
    _global_sinks.add(self)
</code></pre>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Stream" title="GitHub User: Stream">@Stream</a>.register_api()
class sink(Sink):
    &ldquo;&rdquo;&rdquo; Apply a function on every element
    Parameters
    ----------
    func: callable
        A function that will be applied on every element.
    args:
        Positional arguments that will be passed to <code>func</code> after the incoming element.
    kwargs:
        Stream-specific arguments will be passed to <code>Stream.__init__</code>, the rest of
        them will be passed to <code>func</code>.
    Examples
    --------
    &gt;&gt;&gt; source = Stream()
    &gt;&gt;&gt; L = list()
    &gt;&gt;&gt; source.sink(L.append)
    &gt;&gt;&gt; source.sink(print)
    &gt;&gt;&gt; source.sink(print)
    &gt;&gt;&gt; source.emit(123)
    123
    123
    &gt;&gt;&gt; L
    [123]
    See Also
    --------
    map
    Stream.to_list
    &ldquo;&rdquo;&ldquo;</p>
<pre><code>def __init__(self, upstream, func, *args, **kwargs):
    self.func = func
    # take the stream specific kwargs out
    sig = set(inspect.signature(Stream).parameters)
    stream_kwargs = {k: v for (k, v) in kwargs.items() if k in sig}
    self.kwargs = {k: v for (k, v) in kwargs.items() if k not in sig}
    self.args = args
    super().__init__(upstream, **stream_kwargs)

def update(self, x, who=None, metadata=None):
    result = self.func(x, *self.args, **self.kwargs)
    if gen.isawaitable(result):
        return result
    else:
        return []

def destroy(self):
    super().destroy()
    _global_sinks.remove(self)
</code></pre>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Stream" title="GitHub User: Stream">@Stream</a>.register_api()
class to_textfile(Sink):
    &ldquo;&rdquo;&rdquo; Write elements to a plain text file, one element per line.
        Type of elements must be <code>str</code>.
        Parameters
        ----------
        file: str or file-like
            File to write the elements to. <code>str</code> is treated as a file name to open.
            If file-like, descriptor must be open in text mode. Note that the file
            descriptor will be closed when this sink is destroyed.
        end: str, optional
            This value will be written to the file after each element.
            Defaults to newline character.
        mode: str, optional
            If file is <code>str</code>, file will be opened in this mode. Defaults to <code>"a"</code>
            (append mode).
        Examples
        --------
        &gt;&gt;&gt; source = Stream()
        &gt;&gt;&gt; source.map(str).to_textfile(&ldquo;test.txt&rdquo;)
        &gt;&gt;&gt; source.emit(0)
        &gt;&gt;&gt; source.emit(1)
        &gt;&gt;&gt; print(open(&ldquo;test.txt&rdquo;, &ldquo;r&rdquo;).read())
        0
        1
    &ldquo;&rdquo;&ldquo;</p>
<pre><code>def __init__(self, upstream, file, end="\n", mode="a", **kwargs):
    self._end = end
    self._fp = open(file, mode=mode) if isinstance(file, str) else file
    weakref.finalize(self, self._fp.close)
    super().__init__(upstream, **kwargs)

def __del__(self):
    self._fp.close()

def update(self, x, who=None, metadata=None):
    self._fp.write(x + self._end)
    self._fp.flush()
</code></pre>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Stream" title="GitHub User: Stream">@Stream</a>.register_api()
class map(Stream):
    &ldquo;&rdquo;&rdquo; Apply a function to every element in the stream</p>
<pre><code>Parameters
----------
func: callable
*args :
    The arguments to pass to the function.
**kwargs:
    Keyword arguments to pass to func

Examples
--------
&gt;&gt;&gt; source = Stream()
&gt;&gt;&gt; source.map(lambda x: 2*x).sink(print)
&gt;&gt;&gt; for i in range(5):
...     source.emit(i)
0
2
4
6
8
"""

def __init__(self, upstream, func=None, *args, **kwargs):
    self.func = func
    # this is one of a few stream specific kwargs
    name = kwargs.pop('name', None)
    self.kwargs = kwargs
    self.args = args

    Stream.__init__(self, upstream, name=name)

def update(self, x, who=None):
    try:
        result = self.func(x, *self.args, **self.kwargs)
    except Exception as e:
        logger.exception(e)
        raise
    else:
        return self._emit(result)
</code></pre>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Stream" title="GitHub User: Stream">@Stream</a>.register_api()
class starmap(Stream):
    &ldquo;&rdquo;&rdquo; Apply a function to every element in the stream, splayed out</p>
<pre><code>See ``itertools.starmap``

Parameters
----------
func: callable
*args :
    The arguments to pass to the function.
**kwargs:
    Keyword arguments to pass to func

Examples
--------
&gt;&gt;&gt; source = Stream()
&gt;&gt;&gt; source.starmap(lambda a, b: a + b).sink(print)
&gt;&gt;&gt; for i in range(5):
...     source.emit((i, i))
0
2
4
6
8
"""

def __init__(self, upstream, func, *args, **kwargs):
    self.func = func
    # this is one of a few stream specific kwargs
    name = kwargs.pop('name', None)
    self.kwargs = kwargs
    self.args = args

    Stream.__init__(self, upstream, name=name)

def update(self, x, who=None):
    y = x + self.args
    try:
        result = self.func(*y, **self.kwargs)
    except Exception as e:
        logger.exception(e)
        raise
    else:
        return self._emit(result)
</code></pre>
<p>def _truthy(x):
    return not not x
    # if not isinstance(pd.DataFrame):
    #     return not not x
    # else:
    #     return x.empty</p>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Stream" title="GitHub User: Stream">@Stream</a>.register_api()
class filter(Stream):
    &ldquo;&rdquo;&rdquo; Only pass through elements that satisfy the predicate</p>
<pre><code>Parameters
----------
predicate : function
    The predicate. Should return True or False, where
    True means that the predicate is satisfied.

Examples
--------
&gt;&gt;&gt; source = Stream()
&gt;&gt;&gt; source.filter(lambda x: x % 2 == 0).sink(print)
&gt;&gt;&gt; for i in range(5):
...     source.emit(i)
0
2
4
"""

def __init__(self, upstream, predicate, *args, **kwargs):
    if predicate is None:
        predicate = _truthy
    self.predicate = predicate
    name = kwargs.pop('name', None)
    self.kwargs = kwargs
    self.args = args

    Stream.__init__(self, upstream, name=name,)

def update(self, x, who=None):
    if self.predicate(x, *self.args, **self.kwargs):
        return self._emit(x)
</code></pre>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/gen" title="GitHub User: gen">@gen</a>.coroutine
def httpx(req, render=False, <strong>kwargs):
    httpclient = AsyncHTMLSession(workers=1)
    try:
        if isinstance(req, str):
            response = yield httpclient.get(req)
        elif isinstance(req, dict):
            response = yield httpclient.get(</strong>req)</p>
<pre><code>    if render:
        yield response.html.arender(**kwargs)

    return response
except Exception as e:
    (req, e) &gt;&gt; print
    logger.exception(e)
</code></pre>
<p><a class="magiclink magiclink-github magiclink-mention" href="https://github.com/Stream" title="GitHub User: Stream">@Stream</a>.register_api()
class http(Stream):
    &ldquo;&rdquo;&ldquo;自动http 流中的url，返回response对象.</p>
<pre><code>接受url和requestsdict两种上游数据格式，注意上游流要限速，这个是并发执行，速度很快


:param error:，流或者pipe函数，发生异常时url会被发送到这里
:param workers:并发线程池数量


example::

    s = Stream()
    get_data = lambda x:x.body.decode(
        'utf-8')&gt;&gt;chinese_extract&gt;&gt;sample(20)&gt;&gt;concat('|')
    s.rate_limit(0.1).http(workers=20,error=log).map(get_data).sink(print)

    url&gt;&gt;s

    {'url':'','headers'='','params':''}&gt;&gt;s


    h = http()
    h.map(lambda r:(r.url,r.html.search('&lt;title&gt;{}&lt;/title&gt;')[0]))&gt;&gt;log
    'http://www.518.is'&gt;&gt;h

    [2020-03-17 03:46:30.902542] INFO: log: ('http://518.is/', 'NajaBlog')

Returns::

    response, 常用方法,可用self.request方法获取回来做调试
    # 完整链接提取
    r.html.absolute_links

    # css selector
    about = r.html.find('#about', first=True) #css slectotr
    about.text
    about.attrs
    about.html
    about.find('a')
    about.absolute_links

    # 搜索模版
    r.html.search('Python is a {} language')[0]

    # xpath
    r.html.xpath('a')

    # 条件表达式
    r.html.find('a', containing='kenneth')

    # 常用属性
    response.url
    response.base_url
    response.text
    response.full_text



"""

def __init__(self, upstream=None, render=False, workers=None, error=print, **kwargs):
    """http arender surport.

    [description]

    Args:
        **kwargs: render args retries: int = 8, script: str = None, wait: float = 0.2, scrolldown=False, sleep: int = 0, reload: bool = True, timeout: Union[float, int] = 8.0, keep_page: bool = False
        upstream: [description] (default: {None})
        render: [description] (default: {False})
        workers: [description] (default: {None})
        error: [description] (default: {print})
    """
    self.error = error
    self.render = render
    Stream.__init__(self, upstream=upstream, ensure_io_loop=True)
    self.httpclient = AsyncHTMLSession(workers=workers)
    self.kwargs = kwargs

def update(self, req, who=None):
    self.loop.add_future(
        self._request(req),
        lambda x: self._emit(x.result())
    )

def emit(self, req, **kwargs):
    self.update(req)
    return req

@gen.coroutine
def _request(self, req):
    try:
        if isinstance(req, str):
            response = yield self.httpclient.get(req)
        elif isinstance(req, dict):
            response = yield self.httpclient.get(**req)

        if self.render:
            yield response.html.arender(**self.kwargs)

        return response
    except Exception as e:
        (req, e) &gt;&gt; self.error
        logger.exception(e)

@classmethod
def request(cls, url, **kwargs):
    from requests_html import HTMLSession
    httpclient = HTMLSession()
    try:
        kwargs.update({'url': url})
        response = httpclient.get(**kwargs)

        return response
    except Exception as e:
        logger.exception(e)

@classmethod
def get(cls, url, **kwargs):
    return cls.request(url, **kwargs)

x = httpx
</code></pre>
<p>def sync(loop, func, <em>args, *</em>kwargs):
    &ldquo;&rdquo;&rdquo;
    Run coroutine in loop running in separate thread.
    &ldquo;&rdquo;&rdquo;
    # This was taken from distrbuted/utils.py</p>
<pre><code># Tornado's PollIOLoop doesn't raise when using closed, do it ourselves
loop = loop or get_io_loop()
if PollIOLoop\
    and ((isinstance(loop, PollIOLoop)
          and getattr(loop, '_closing', False))
         or (hasattr(loop, 'asyncio_loop')
             and loop.asyncio_loop._closed)):
    raise RuntimeError("IOLoop is closed")

timeout = kwargs.pop('callback_timeout', None)

e = threading.Event()
main_tid = get_thread_identity()
result = [None]
error = [False]

@gen.coroutine
def f():
    try:
        if main_tid == get_thread_identity():
            raise RuntimeError("sync() called from thread of running loop")
        yield gen.moment
        thread_state.asynchronous = True
        future = func(*args, **kwargs)
        if timeout is not None:
            future = gen.with_timeout(timedelta(seconds=timeout), future)
        result[0] = yield future
    except Exception:
        error[0] = sys.exc_info()
    finally:
        thread_state.asynchronous = False
        e.set()

loop.add_callback(f)
if timeout is not None:
    if not e.wait(timeout):
        raise gen.TimeoutError("timed out after %s s." % (timeout,))
else:
    while not e.is_set():
        e.wait(10)
if error[0]:
    six.reraise(*error[0])
else:
    return result[0]
</code></pre>
<p>class Deva():
    <a class="magiclink magiclink-github magiclink-mention" href="https://github.com/classmethod" title="GitHub User: classmethod">@classmethod</a>
    def run(cls,):
        # loop = IOLoop()
        # loop.make_current()
        # loop.start()</p>
<pre><code>    loop = get_io_loop(asynchronous=False)
    loop.instance().start()
    # import asyncio
    # l = asyncio.new_event_loop()

    # l.run_forever()
</code></pre>
<p>print(os.getpid())</p></article></body></html>